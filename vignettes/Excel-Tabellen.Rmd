---
title: "Excel-Tabellen"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Excel-Tabellen}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Formatierte Excel-Tabellen mit R

`statR` enthält mehrere Funktionen, mit welchen Datensätze aus `R` als Excel-Dateien exportiert werden können. Die Funktionen bauen auf dem [openxlsx-package](https://github.com/awalker89/openxlsx) auf. Per Default wird bei allen Funktionen das Logo des Statistischen Amts eingefügt und es werden die Kontaktangaben des Datashops angegeben (`contactdetails = statzh`).  Mit dem Argument `grouplines` kann man zudem vertikale Linien zwischen ausgewählten Spalten in der Excel-Tabelle einfügen, um die Spalten optisch voneinander zu separieren.

__quickXLSX()__

Mit der Funktion `quickXLSX()` kann ein Datensatz aus `R` als vorformatierte XLSX-Datei exportiert werden. 

```{r,echo=T,eval=F,error=F}
# Beispiel anhand des Datensatzes 'mtcars'
dat <- mtcars

quickXLSX(data = dat, 
          title = "Motor trend car road tests", 
          file = "motor_trend_car_road_tests", # '.xlsx' wird automatisch hinzugefügt
          source = "Source: Henderson and Velleman (1981), 
          Building multiple regression models interactively. Biometrics, 37, 391–411.",
          metadata = "The data was extracted from the 1974 Motor Trend US magazine, 
          and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).",
          contactdetails = "statzh",
          grouplines = FALSE,
          logo = NULL
          )
```




__splitXLSX()__ 

Mit der Funktion `splitXLSX()` kann ein Datensatz aus R in eine XLSX-Datei über mehrere Arbeitsblätter hinweg exportiert werden.

Im Beispiel unten wird der Datensatz nach der Anzahl Zylinder der Autos auf verschiedene Arbeitsblätter verteilt. 


```{r,echo=T,eval=F}
# Beispiel anhand des Datensatzes 'mtcars'
dat <- mtcars

# Beispiel mit Standardlogo (Logo des Statistischen Amts)
splitXLSX(data = dat,
          file = "motor_trend_car_road_tests", # '.xlsx' wird automatisch hinzugefügt
          sheetvar = cyl, # Variable, nach der die Daten auf die Tabellenblätter aufgeteilt werden sollen
          source = "Source: Henderson and Velleman (1981), 
          Building multiple regression models interactively. Biometrics, 37, 391–411.",
          metadata = "The data was extracted from the 1974 Motor Trend US magazine, 
          and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).",
          contactdetails = "statzh",
          grouplines = FALSE,
          logo = NULL
          )

```

__datasetsXLSX() (*NEU*)__

Die Funktion datasetsXLSX erlaubt es mehrere Datensätze aus R in einer XLSX-Tabelle mit mehreren Arbeitsblättern zu bündeln.

Beispiel mit zwei Datensätzen:


```{r,echo=T,eval=F}

datasetsXLSX(file="datasetsXLSX2"
,maintitle = "nice datasets"
,datasets = list(head(mtcars),tail(mtcars))
,sheetnames = c("data1","data2")
,titles = c("Title","Title")
,sources = c("Quelle: STATENT", "Quelle: Strukturerhebung")
,metadata1 = c("Bemerkungen: x", "Bemerkungen: x")
,auftrag_id="AS2020_01"
)

```
Tabellenblätter können auch Bilder oder Plots enthalten.

```{r,echo=T,eval=F}

plot <- plot(mtcars$mpg)

datasetsXLSX(file="datasetsXLSX",
            maintitle = "nice datasets",
             datasets = list(head(mtcars),tail(mtcars),plot),
            sheetnames = c("data1","data2","map"),
            widths = c(0,0,5),
             heights = c(0,0,2.5),
             startrows = c(0,0,10),
             startcols = c(0,0,8),
             titles = c("Title","Title", "Plot"),
             sources = c("Quelle: STATENT", "Quelle: Strukturerhebung", "Quelle: Strukturerhebung"),
             metadata1 = c("Bemerkungen: bla", "Bemerkungen: x", "Bemerkungen: x"),
             auftrag_id="A2020_0200"
)
```

__insert_worksheet__

Schreibt Daten aus R in eine XLSX-Tabelle mit einem einzelnen Arbeitsblatt.
```{r,echo=T,eval=F,error=F}

#erstelle ein neues Workbook
wb <- openxlsx::createWorkbook("hello")

#schreibe daten in ein neues sheet im bestehenden Workbook
insert_worksheet(mtcars[c(1:25),],wb)

#speichere workbook als xlsx-Datei ab
openxlsx::saveWorkbook(wb, "file.xlsx", overwrite = TRUE)

```
