---
title: "Excel-Tabellen"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Excel-Tabellen}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Formatierte Excel-Tabellen mit R

`statR` enthält mehrere Funktionen, mit welchen Datensätze aus `R` als Excel-Dateien exportiert werden können. Die Funktionen bauen auf dem [openxlsx-package](https://github.com/awalker89/openxlsx) auf.

__quickXLSX__

Mit der Funktion `quickXLSX()` kann ein Datensatz aus `R` als vorformatierte XLSX-Datei exportiert werden. Per Default wird das Logo des Statistischen Amts eingefügt und es werden die Kontaktangaben des Datashops angegeben (`contactdetails = statzh`).  Mit dem Argument `grouplines` kann man zudem vertikale Linien zwischen ausgewählten Spalten in der Excel-Tabelle einfügen, um die Spalten optisch voneinander zu separieren.

```{r,echo=T,eval=F,error=F}
# Beispiel anhand des Datensatzes 'mtcars'
dat <- mtcars

quickXLSX(data = dat, 
          title = "Motor trend car road tests", 
          file = "motor_trend_car_road_tests", # '.xlsx' wird automatisch hinzugefügt
          source = "Source: Henderson and Velleman (1981), Building multiple regression models interactively. Biometrics, 37, 391–411.",
          metadata = "The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).",
          contactdetails = "statzh",
          grouplines = FALSE,
          logo = NULL
          )
```




__splitXLSX__ 

Die Funktion `splitXLSX` erlaubt es, einen Datensatz aus R in einer XLSX-Tabelle mit mehreren Arbeitsblättern abzuspeichern und die Daten über mehrere Tabellenblätter zu verteilen.

Beispiel: Speichere die ersten 10 Zeilen des mtcars-Datemsatzes in mehreren Arbeitsblättern ab, ein Blatt pro Kategorie der 'carb'-Variable. Die Funktion eignet sich für Excel-Files welche pro Jahr oder pro Region etc. jeweils einzelne Arbeitsblätter enthalten sollen.

```{r,echo=T,eval=F}
#Beispiel mit Standardlogo (Logo des Statistischen Amtes ZH)
splitXLSX(mtcars[c(1:10),],"mtcars",carb,grouplines=c(1,5,6))

#Beispiel mit modifzierten Bemerkungen und eigenem Logo
splitXLSX(head(mtcars),carb, file="filename",grouplines = c(1,2,3), metadata = "remarks: ....",source="canton of zurich",logo="L:/STAT/08_DS/06_Diffusion/Logos_Bilder/LOGOS/STAT_LOGOS/nacht_map.png")

```

__datasetsXLSX (*NEU*)__

Die Funktion datasetsXLSX erlaubt es mehrere Datensätze aus R in einer XLSX-Tabelle mit mehreren Arbeitsblättern zu bündeln.

Beispiel mit zwei Datensätzen:


```{r,echo=T,eval=F}

datasetsXLSX(file="datasetsXLSX2"
,maintitle = "nice datasets"
,datasets = list(head(mtcars),tail(mtcars))
,sheetnames = c("data1","data2")
,titles = c("Title","Title")
,sources = c("Quelle: STATENT", "Quelle: Strukturerhebung")
,metadata1 = c("Bemerkungen: x", "Bemerkungen: x")
,auftrag_id="AS2020_01"
)

```
Tabellenblätter können auch Bilder oder Plots enthalten.

```{r,echo=T,eval=F}

plot <- plot(mtcars$mpg)

datasetsXLSX(file="datasetsXLSX",
            maintitle = "nice datasets",
             datasets = list(head(mtcars),tail(mtcars),plot),
            sheetnames = c("data1","data2","map"),
            widths = c(0,0,5),
             heights = c(0,0,2.5),
             startrows = c(0,0,10),
             startcols = c(0,0,8),
             titles = c("Title","Title", "Plot"),
             sources = c("Quelle: STATENT", "Quelle: Strukturerhebung", "Quelle: Strukturerhebung"),
             metadata1 = c("Bemerkungen: bla", "Bemerkungen: x", "Bemerkungen: x"),
             auftrag_id="A2020_0200"
)
```

__insert_worksheet__

Schreibt Daten aus R in eine XLSX-Tabelle mit einem einzelnen Arbeitsblatt.
```{r,echo=T,eval=F,error=F}

#erstelle ein neues Workbook
wb <- openxlsx::createWorkbook("hello")

#schreibe daten in ein neues sheet im bestehenden Workbook
insert_worksheet(mtcars[c(1:25),],wb)

#speichere workbook als xlsx-Datei ab
openxlsx::saveWorkbook(wb, "file.xlsx", overwrite = TRUE)

```
