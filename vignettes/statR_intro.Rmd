---
title: "statR_intro"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{statR_intro}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


statR-package enthält:

- Das Stat ZH Theme (stat_theme()) für ggplot2 Grafiken
- Farbpaletten (zhpal)
- Farbpaletten-Funktionen für ggplot2
- Funktionen um Datensätze aus R in formattierte und Kantons CD-konforme XLSX-files abzuspeichern.

Zu jeder Funktion ist mittels Hilfe-Befehl (?) eine Beschreibung sowie ein Verwendungsbeispiel aufrufbar (z.B.: ?splitXLSX )

# Installation
Das Package liegt auf github und kann wiefolgt installiert werden.
```{r,echo=T,eval=T,message=F,warning=F}
library(pacman)

#Variante 1
library(downloader)
download("https://github.com/statistikZH/statR/archive/master.tar.gz", "statR.tar.gz")
install.packages("statR.tar.gz", repos = NULL, type = "source")

#Lade package
library(statR)
```

```{r,echo=T,eval=F,message=F,warning=F}
#Variante 2

library(devtools)

install_github("statistikZH/statR")

```

# Theme

Das ggplot2-theme ist darauf ausgelegt, sich gut ins kantonalen Corporate Design einzufügen. 
```{r}
library(ggplot2)

ggplot(mpg, aes(class,fill = drv))+geom_bar()+theme_stat()
```

# Farben
Das Farbpalettenobjekt zhpal, welches alle StatZH-Farbpaletten enthält, ist mit geladenem statR Package global verfügbar. 

```{r,echo=TRUE}
#Zeige Farben an
display(zhpal$zhdiagonal)

#Mische 20 Farbtöne auf Basis der zhdiagonal-Palette
colorRampPalette((zhpal$zhdiagonal),space="Lab")(20)

#Zeige die 20 Farben an
display(colorRampPalette((zhpal$zhdiagonal),space="Lab")(20))

#Alle Paletten auf einen Blick
display.statcol.all()

#verwende die Paletten für kategoriale Daten mittels 'scale_fill_manual'
ggplot(mpg, aes(class,fill = drv))+geom_bar()+theme_stat()+scale_fill_manual(values=zhpal$zhblue)

```

# Formattierte ZH Excel-Tabellen mit R

statR enthält zwei Funktionen welche Daten in formatierte Excel-Dateien abfüllen. Die Funktionen bauen auf dem [openxlsx-package](https://github.com/awalker89/openxlsx) auf.

##insert_worksheet

Schreibt Daten aus R in eine XLSX-Tabelle mit einem einzelnen Arbeitsblatt.
```{r,echo=T,eval=F,error=F}

#erstelle ein neues Workbook
wb <- openxlsx::createWorkbook("hello")

#schreibe daten in ein neues sheet im bestehenden Workbook
insert_worksheet(mtcars[c(1:25),],wb)

#speichere workbook als xlsx-Datei ab
openxlsx::saveWorkbook(wb, "file.xlsx", overwrite = TRUE)

```

##quickXLSX

Schreibt Daten aus R in eine XLSX-Tabelle mit einem einzelnen Arbeitsblatt.
```{r,echo=T,eval=F,error=F}
#Beschreibung & Anwendungsbeispiele via '?'
?quickXLSX

#Speichere die obersten Zeilen des mtcars-Datensatzes als formatiertes XLSX File ab
quickXLSX(head(mtcars),"title of the spreadsheet")
```

##splitXLSX 

Die Funktion splitXLSX erlaubt es Daten aus R in einer XLSX-Tabelle mit mehreren Arbeitsblättern abspeichern.
Beispiel: Speichere die ersten 10 Zeilen des mtcars-Datemsatzes in mehreren Arbeitsblättern ab, ein Blatt pro Kategorie der 'carb'-Variable. Die Funktion eignet sich für Excel-Files welche pro Jahr oder pro Region etc. jeweils einzelne Arbeitsblätter enthalten sollen.
```{r,echo=T,eval=F}
#Beispiel mit Standardlogo (Logo des Statistischen Amtes ZH)
splitXLSX(mtcars[c(1:10),],"mtcars",carb,grouplines=c(1,5,6))

#Beispiel mit modifzierten Bemerkungen und eigenem Logo
splitXLSX(head(mtcars),carb, file="filename",grouplines = c(1,2,3), metadata = "remarks: ....",source="canton of zurich",logo="L:/STAT/08_DS/06_Diffusion/Logos_Bilder/LOGOS/STAT_LOGOS/nacht_map.png")

```

